<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlipHawk | Smart Arbitrage Scanner</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .nav {
      background: white;
      padding: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-top: 20px;
    }
    button {
      background: #22c55e;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
    }
    button:disabled {
      background: #ccc;
    }
    select, input {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .loading {
      text-align: center;
      padding: 20px;
    }
    .error {
      color: red;
      padding: 10px;
      margin: 10px 0;
    }
    .results {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .result-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div class="nav">
    <div class="container">
      <h1>FlipHawk</h1>
    </div>
  </div>
  
  <div class="container">
    <div class="card">
      <h2>Find Arbitrage Opportunities</h2>
      <select id="category">
        <option value="">Select a category</option>
        <option value="Tech">Tech</option>
        <option value="Collectibles">Collectibles</option>
        <option value="Vintage Clothing">Vintage Clothing</option>
        <option value="Antiques">Antiques</option>
        <option value="Gaming">Gaming</option>
        <option value="Music Gear">Music Gear</option>
        <option value="Tools & DIY">Tools & DIY</option>
        <option value="Outdoors & Sports">Outdoors & Sports</option>
      </select>
      
      <div id="subcategories"></div>
      
      <button id="scanButton" disabled>Find Opportunities</button>
      
      <div id="error" class="error" style="display: none;"></div>
      <div id="loading" class="loading" style="display: none;">Scanning...</div>
      <div id="results" class="results"></div>
    </div>
  </div>

  <script>
    // Categories data
    const categories = {
      "Tech": ["Headphones", "Keyboards", "Graphics Cards", "CPUs", "Laptops", "Monitors", "SSDs", "Routers", "Vintage Tech"],
      "Collectibles": ["Pok√©mon", "Magic: The Gathering", "Yu-Gi-Oh", "Funko Pops", "Sports Cards", "Comic Books", "Action Figures", "LEGO Sets"],
      "Vintage Clothing": ["Jordans", "Nike Dunks", "Vintage Tees", "Band Tees", "Denim Jackets", "Designer Brands", "Carhartt", "Patagonia"],
      "Antiques": ["Coins", "Watches", "Cameras", "Typewriters", "Vinyl Records", "Vintage Tools", "Old Maps", "Antique Toys"],
      "Gaming": ["Consoles", "Game Controllers", "Rare Games", "Arcade Machines", "Handhelds", "Gaming Headsets", "VR Gear"],
      "Music Gear": ["Electric Guitars", "Guitar Pedals", "Synthesizers", "Vintage Amps", "Microphones", "DJ Equipment"],
      "Tools & DIY": ["Power Tools", "Hand Tools", "Welding Equipment", "Toolboxes", "Measuring Devices", "Woodworking Tools"],
      "Outdoors & Sports": ["Bikes", "Skateboards", "Scooters", "Camping Gear", "Hiking Gear", "Fishing Gear", "Snowboards"]
    };

    const categorySelect = document.getElementById('category');
    const subcategoriesDiv = document.getElementById('subcategories');
    const scanButton = document.getElementById('scanButton');
    const errorDiv = document.getElementById('error');
    const loadingDiv = document.getElementById('loading');
    const resultsDiv = document.getElementById('results');
    
    let selectedSubcategories = [];

    categorySelect.addEventListener('change', function() {
      const category = this.value;
      selectedSubcategories = [];
      
      if (category) {
        const subcats = categories[category];
        let html = '<h3>Select Subcategories (up to 5)</h3>';
        subcats.forEach(subcat => {
          html += `
            <label style="display: block; margin: 5px 0;">
              <input type="checkbox" value="${subcat}" onchange="handleSubcategoryChange(this)">
              ${subcat}
            </label>
          `;
        });
        subcategoriesDiv.innerHTML = html;
      } else {
        subcategoriesDiv.innerHTML = '';
      }
      
      updateScanButton();
    });

    function handleSubcategoryChange(checkbox) {
      if (checkbox.checked) {
        if (selectedSubcategories.length < 5) {
          selectedSubcategories.push(checkbox.value);
        } else {
          checkbox.checked = false;
          alert('You can only select up to 5 subcategories');
        }
      } else {
        selectedSubcategories = selectedSubcategories.filter(item => item !== checkbox.value);
      }
      
      updateScanButton();
    }

    function updateScanButton() {
      scanButton.disabled = !(categorySelect.value && selectedSubcategories.length > 0);
    }

    scanButton.addEventListener('click', async function() {
      errorDiv.style.display = 'none';
      loadingDiv.style.display = 'block';
      resultsDiv.innerHTML = '';
      scanButton.disabled = true;
      
      try {
        const response = await fetch('/api/v1/scan', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            category: categorySelect.value,
            subcategories: selectedSubcategories
          })
        });
        
        if (!response.ok) {
          throw new Error('Scan failed');
        }
        
        const data = await response.json();
        displayResults(data);
        
      } catch (error) {
        errorDiv.textContent = 'Failed to run scan. Please try again.';
        errorDiv.style.display = 'block';
      } finally {
        loadingDiv.style.display = 'none';
        updateScanButton();
      }
    });

    function displayResults(results) {
      if (results.length === 0) {
        resultsDiv.innerHTML = '<p>No opportunities found</p>';
        return;
      }
      
      const html = results.map(result => `
        <div class="result-card">
          <h3>${result.title}</h3>
          <p>Buy: $${result.buyPrice.toFixed(2)}</p>
          <p>Sell: $${result.sellPrice.toFixed(2)}</p>
          <p>Profit: $${result.profit.toFixed(2)} (${result.profitPercentage.toFixed(1)}%)</p>
          <p>Confidence: ${result.confidence}%</p>
          <p><a href="${result.buyLink}" target="_blank">Buy Link</a> | <a href="${result.sellLink}" target="_blank">Sell Link</a></p>
        </div>
      `).join('');
      
      resultsDiv.innerHTML = html;
    }
  </script>
</body>
</html>
